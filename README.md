# Orca 哔哩哔哩视频信息提取插件

自动提取B站视频封面、UP主信息、视频标签等，并设置为Orca标签属性。

## 功能特性

- ✨ 自动识别B站视频链接（BV号/av号）
- 🖼️ 提取视频封面图片
- 👤 提取UP主信息
- 🏷️ 提取视频标签
- ⚙️ 可配置是否插入图片块
- 📋 右键菜单快捷操作
- 🎯 粘贴链接自动处理

## 使用方法

### 1. 粘贴链接自动提取

直接粘贴B站视频链接（如 `https://www.bilibili.com/video/BV1xx411c7XD`），插件会自动：
- 提取视频信息
- 添加"哔哩哔哩"标签，并设置以下属性：
  - `img`：视频封面URL
  - `tags`：视频标签（用 `|` 分隔）
- （可选）在块下方插入封面图片
- 添加"哔哩UP：XXX"标签

### 2. 右键菜单提取

在包含B站链接的块上：
1. 右键点击
2. 选择 "🎬 提取B站视频信息"

### 3. 命令面板

使用命令 `提取哔哩哔哩视频信息`

## 插件设置

在 Orca 设置 > 插件 > 哔哩哔哩插件 中配置：

- **插入图片块**（默认：开启）
  - 开启：在块下方插入封面图片
  - 关闭：仅将图片URL存储在标签属性中

> 注意：无论此选项如何设置，图片URL都会存储在"哔哩哔哩"标签的 `img` 属性中。

## 标签属性说明

### 哔哩哔哩标签

- **img** (文本)：视频封面图片URL
- **tags** (文本)：视频标签列表，用 `|` 分隔
  - 例如：`东方|PV|IOSYS|现存元老`

### 哔哩UP标签

- 格式：`哔哩UP：{UP主名称}`
- 用于快速识别UP主


### 模块化设计

- **常量模块**：URL正则、API配置
- **类型定义**：TypeScript接口
- **工具函数**：URL解析、链接检测
- **API调用模块**：视频信息、标签获取
- **业务逻辑**：处理B站链接
- **事件处理**：粘贴监听
- **插件生命周期**：加载/卸载

### 单元测试覆盖

- ✅ 工具函数测试（URL提取、链接检测）
- ✅ API调用测试（mock fetch）
- ✅ 错误处理测试
- ✅ 边界情况测试

## API 使用

插件使用以下B站API：

1. **视频信息API**
   ```
   GET https://api.bilibili.com/x/web-interface/view?bvid={videoId}
   ```
   返回：封面、标题、UP主信息

2. **视频标签API**
   ```
   GET https://api.bilibili.com/x/tag/archive/tags?bvid={videoId}
   ```
   返回：标签列表

## 许可证

MIT License

## 作者

SaXz2

## 贡献

欢迎提交 Issue 和 Pull Request！

## 更新日志

### v1.0.0

- ✨ 初始版本
- 支持提取视频封面、UP主、标签
- 支持标签属性存储
- 可配置图片插入选项
- 完整的单元测试覆盖